<!DOCTYPE html>
<html>
  <head>
  <script src="jquery.js"></script>
  <script src="mylib.js"></script>
  <script src="data.js"></script>
  </head>

  <body ng-app="" ng-controller="cont">
    <h2>Interpreter</h2>

    <textarea id="input"></textarea>
    <button onclick="action()">Procesar</button>
    <p>
      DATA:
      <pre id="data"></pre>
    </p>
    <p>
      EXP:
      <pre id="exp"></pre>
    </p>

    <p>
      <pre id="debug"></pre>
    </p>
  </body>

  <script>

    Exp = function () {
      this.chao = "Chao";
    }

    data = {};

    function input () {
      return $('#input').val();
    }
    function output (val) {
      $('#output').text(val);
    }
    function debug (val, id) {
      if (id) {
        id = '#' + id;
      } else {
        id = '#debug';
      }
      console.log(val);
      $(id).text(ml.tojson(val));
    }

    function toExp (str) {
      var level = 0;
      var lastOpen = -1;
      var lastClose = -1;
      var arr = [];

      for (var i = 0; i < str.length; i++) {
        var ch = str[i];
        if (ch == '(') {
          if (level == 0) {
            lastOpen = i;
          }
          level++;
        }
        if (ch == ')') {
          level--;
          if (level == 0) {
            lastClose = i;
            var ls = str.slice(lastOpen + 1, lastClose);
            arr.push(toExp(ls));
          }
        }
      }

      if (arr.length == 0 && str.length > 0) {
        return new Exp();
      }

      return arr;
    }

    function action () {
      var mainCmd = input();
      var mainExp = toExp(mainCmd);
      //debug(data, 'data');
      debug(mainExp, 'exp');
    }
  </script>
</html>